FROM python:3.13.0@sha256:bc78d3c007f86dbb87d711b8b082d9d564b8025487e780d24ccb8581d83ef8b0

WORKDIR /usr/src/app

COPY ./dataland-automated-qa-service/requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

COPY ./dataland-automated-qa-service/pyproject.toml ./

COPY ./dataland-automated-qa-service/src/main/ ./src/main/

COPY ./dataland-document-manager/documentManagerOpenApi.json ./dataland-document-manager/documentManagerOpenApi.json
COPY ./dataland-backend/backendOpenApi.json ./dataland-backend/backendOpenApi.json
RUN openapi-python-client generate --path ./dataland-document-manager/documentManagerOpenApi.json
RUN openapi-python-client generate --path ./dataland-backend/backendOpenApi.json
RUN pip install --no-cache-dir ./dataland-backend-api-documentation-client
RUN pip install --no-cache-dir ./dataland-document-manager-api-documentation-client
RUN pip install -e .
