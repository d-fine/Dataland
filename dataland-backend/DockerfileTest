FROM ghcr.io/d-fine/dataland/temurinbase:latest
ARG GITHUB_USER
ARG GITHUB_TOKEN

COPY ./gradle/ /app/gradle/
COPY ./build.gradle.kts ./gradle.properties ./settings.gradle.kts ./gradlew /app/
COPY ./dataland-backend/ /app/dataland-backend
COPY ./.git/ /app/.git
WORKDIR /app
RUN GITHUB_USER=$GITHUB_USER GITHUB_TOKEN=$GITHUB_TOKEN ./gradlew dataland-backend:bootJar --no-daemon --stacktrace

RUN GITHUB_USER=$GITHUB_USER GITHUB_TOKEN=$GITHUB_TOKEN ./gradlew :dataland-backend:bootRun --args='--spring.profiles.active=ci' --no-daemon --stacktrace
