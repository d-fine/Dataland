ARG DATALAND_BACKEND_BASE_VERSION
FROM ghcr.io/d-fine/dataland/dataland_backend_base:${DATALAND_BACKEND_BASE_VERSION}

CMD ./gradlew :dataland-backend:bootRun --args='--spring.profiles.active=ci' --no-daemon --stacktrace

RUN apt-get update && \
    apt-get install -y curl jq && \
    apt-get clean

HEALTHCHECK --interval=30s --timeout=3s CMD curl -f http://localhost:8080/api/actuator/health/ping | jq ".status" | grep -q 'UP'
