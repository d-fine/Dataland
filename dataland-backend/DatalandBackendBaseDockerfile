ARG DATALAND_GRADLE_BASE_VERSION
FROM ghcr.io/d-fine/dataland/dataland_gradle_base:${DATALAND_GRADLE_BASE_VERSION} as builder

WORKDIR /app
COPY ./dataland-backend/ ./dataland-backend/
COPY ./.git/ ./.git
RUN --mount=type=secret,id=DOCKER_SECRET \
     cp /run/secrets/DOCKER_SECRET ~/.gradle/gradle.properties && \
     ./gradlew dataland-backend:bootJar --no-daemon --stacktrace &&  \
     rm -rf ~/.gradle/gradle.properties
