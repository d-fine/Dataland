FROM eclipse-temurin:21.0.5_11-jdk-jammy@sha256:4c19911e6c22732db123ffaf049d033b9fe487935cffe265d1517cd26dac7f11 AS builder

WORKDIR /app

COPY ./gradle/ ./gradle/
COPY ./gradlew .
RUN  ./gradlew --version
COPY ./build.gradle.kts ./gradle.properties ./settings.gradle.kts ./versions.properties ./
RUN ./gradlew --no-daemon --stacktrace

# Copy the health check script and service file into the image
COPY ./healthCheck.sh /usr/local/bin/healthCheck.sh
# Make the script executable
RUN chmod +x /usr/local/bin/healthCheck.sh
HEALTHCHECK --interval=30s --timeout=10s --retries=3 CMD /usr/local/bin/healthCheck.sh