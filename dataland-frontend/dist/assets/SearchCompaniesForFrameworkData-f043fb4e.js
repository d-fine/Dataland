import{A as M,a as K}from"./ApiClients-c2d52430.js";import{a as W,T as z}from"./TheHeader-0690a93c.js";import{g as Y,F as j}from"./FrameworkDataSearchBar-c5428140.js";import{d as _,s as A,_ as b,r as l,o as d,n as S,w as c,f as n,a as r,I as G,c as m,J,h as k,v as F,y as h,x as v,F as R,j as w,p as P,g as T,i as V,e as x,L as C,M as X,N as Z,O as ee,u as te}from"./index-2a0d7e9b.js";import{s as re,a as ae}from"./column.esm-4af04ca3.js";import{T as se}from"./tooltip.esm-67eb1d6e.js";import{g as oe}from"./CountryCodeConverter-d8382291.js";import{s as ie}from"./multiselect.esm-8dae9e92.js";import{h as le}from"./StringHumanizer-b303955c.js";import{T as ne}from"./TheFooter-3b777f63.js";import{D as de}from"./DatasetsTabMenu-52aae5cd.js";import{N as ce}from"./NewDatasetButton-9f46ca6a.js";import"./SearchResultHighlighter-7144da99.js";import"./virtualscroller.esm-6815c49e.js";import"./index.esm-46141996.js";import"./qa-status-272129d3.js";import"./dropdown.esm-db79d236.js";import"./inputtext.esm-51fe2afe.js";import"./index.esm-e4a4c290.js";import"./index.esm-53a24283.js";import"./index.esm-cdf29d06.js";import"./index.esm-64549a61.js";const ue=_({name:"RequestDataButton",components:{PrimeButton:A}}),me=r("i",{class:"material-icons"}," add_box ",-1),he=r("span",{class:"d-letters pl-2"}," Request Data ",-1);function pe(e,t,a,s,u,y){const i=l("PrimeButton"),o=l("router-link");return d(),S(o,{to:"/requests",class:"no-underline","data-test":"requestDataButton"},{default:c(()=>[n(i,{class:"uppercase p-button p-button-sm mr-3"},{default:c(()=>[me,he]),_:1})]),_:1})}const q=b(ue,[["render",pe]]),fe=_({name:"FrameworkDataSearchResults",components:{RequestDataButton:q,DataTable:re,Column:ae},directives:{tooltip:se},props:{data:{type:Object,default:null},rowsPerPage:{type:Number,default:null}},methods:{goToData(e){return this.$router.push(Y(e.data))},resetPagination(){this.$refs.dataTable&&this.$refs.dataTable.resetPage()},firstUpdated(e){window.scrollTo(0,0),this.$emit("update:first",e)}}});const we={class:"col-12 text-left"},Fe=r("span",{class:"uppercase"},"PERM ID",-1),ye={class:"material-icons pl-2","aria-hidden":"true",title:"Perm ID"},ge=r("span",{class:"text-primary no-underline font-bold"},[r("span",null," VIEW"),k(),r("span",{class:"ml-3"},">")],-1),Se={key:1,class:"d-center-div text-center px-7 py-4"},ke=r("p",{class:"font-medium text-xl"},"We're sorry, but your search did not return any results.",-1),Ce=r("p",{class:"font-medium text-xl"}," Please double-check the spelling and try again or request the data you are missing! ",-1);function _e(e,t,a,s,u,y){const i=l("Column"),o=l("DataTable"),D=l("RequestDataButton"),I=G("tooltip");return d(),m("div",we,[e.data&&e.data.length>0?(d(),S(o,{key:0,ref:"dataTable",value:e.data,paginator:!0,rows:e.rowsPerPage,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport",alwaysShowPaginator:!1,currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} entries","onUpdate:first":e.firstUpdated,onRowClick:e.goToData,class:"table-cursor",id:"search-result-framework-data",rowHover:!0},{default:c(()=>[n(i,{field:"companyInformation.companyName",header:"COMPANY",sortable:!0,class:"d-bg-white w-3 d-datatable-column-left"}),n(i,{field:"companyInformation.permId",sortable:!1,class:"d-bg-white w-2"},{header:c(()=>[Fe,J((d(),m("i",ye,[k("info")])),[[I,{value:"Permanent Identifier (PermID) is a machine readable identifier that provides a unique reference for data items including organizations, instruments, funds, issuers and people. You can search and verify an id at permid.org/search",class:"d-tooltip"},void 0,{top:!0}]])]),body:c(({data:p})=>[k(F(p.permId?p.permId:"Not available"),1)]),_:1}),n(i,{field:"companyInformation.sector",header:"SECTOR",sortable:!0,class:"d-bg-white w-2"}),n(i,{field:"companyInformation.headquarters",header:"LOCATION",sortable:!0,class:"d-bg-white w-2"},{body:c(({data:p})=>[k(F(p.companyInformation.headquarters)+", "+F(p.companyInformation.countryCode),1)]),_:1}),n(i,{field:"companyId",header:"",class:"d-bg-white w-1 d-datatable-column-right"},{body:c(()=>[ge]),_:1})]),_:1},8,["value","rows","onUpdate:first","onRowClick"])):(d(),m("div",Se,[ke,Ce,n(D)]))])}const be=b(fe,[["render",_e]]),ve=_({setup(){return{multiselect:h()}},name:"FrameworkDataSearchDropdownFilter",components:{MultiSelect:ie},emits:["update:modelValue"],props:{availableItems:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]},filterName:{type:String,default:""},filterId:{type:String,default:""},filterPlaceholder:{type:String,default:""}},data(){return{overlayVisible:!1}},computed:{selectionButtonClasses(){const e=["selection-button","flex","flex-row","align-items-center"];return this.overlayVisible?e.push("overlayVisible"):this.modelValue.length>0&&e.push("filterActive"),e},selectedItemsBind:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}});const Be=e=>(P("data-v-b3f90842"),e=e(),T(),e),De=["id"],Ie={key:2,class:"p-badge p-component p-badge-no-gutter ml-1 round"},$e=Be(()=>r("svg",{class:"ml-2",xmlns:"http://www.w3.org/2000/svg",width:"10",height:"7","xml:space":"preserve"},[r("polygon",{points:"0,0 5,5 10,0",fill:"currentColor"})],-1));function Pe(e,t,a,s,u,y){const i=l("MultiSelect");return d(),S(i,{modelValue:e.selectedItemsBind,"onUpdate:modelValue":t[0]||(t[0]=o=>e.selectedItemsBind=o),ref:"multiselect",options:e.availableItems,filter:!0,showToggleAll:!1,filterPlaceholder:e.filterPlaceholder,panelClass:"d-framework-data-search-dropdown",optionLabel:"displayName",optionDisabled:"disabled",onBeforeShow:t[1]||(t[1]=o=>this.overlayVisible=!0),onBeforeHide:t[2]||(t[2]=o=>this.overlayVisible=!1)},{dropdownicon:c(()=>[r("div",{class:v(e.selectionButtonClasses)},[r("div",{class:"selection-button-content",id:e.filterId},[this.modelValue.length===1?(d(),m(R,{key:0},[k(F(e.modelValue[0].displayName),1)],64)):(d(),m(R,{key:1},[k(F(e.filterName),1)],64)),this.modelValue.length>0?(d(),m("span",Ie,F(e.modelValue.length),1)):w("",!0),$e],8,De)],2)]),_:1},8,["modelValue","options","filterPlaceholder"])}const Te=b(ve,[["render",Pe],["__scopeId","data-v-b3f90842"]]),Re=_({name:"FrameworkDataSearchFilters",components:{FrameworkDataSearchDropdownFilter:Te},emits:["update:selectedCountryCodes","update:selectedFrameworks","update:selectedSectors"],setup(){return{sectorFilter:h(),countryFilter:h(),frameworkFilter:h(),getKeycloakPromise:V("getKeycloakPromise")}},props:{selectedFrameworks:{type:Array,default:()=>[]},selectedSectors:{type:Array,default:()=>[]},selectedCountryCodes:{type:Array,default:()=>[]},showHeading:{type:Boolean,default:!0}},data(){return{availableCountries:[],availableFrameworks:[],availableSectors:[]}},computed:{selectedCountriesInt:{get(){return this.availableCountries.filter(e=>this.selectedCountryCodes.includes(e.countryCode))},set(e){this.$emit("update:selectedCountryCodes",e.map(t=>t.countryCode))}},selectedFrameworksInt:{get(){return this.availableFrameworks.filter(e=>this.selectedFrameworks.includes(e.frameworkDataType))},set(e){this.$emit("update:selectedFrameworks",e.map(t=>t.frameworkDataType))}},selectedSectorsInt:{get(){return this.availableSectors.filter(e=>this.selectedSectors.includes(e.displayName))},set(e){this.$emit("update:selectedSectors",e.map(t=>t.displayName))}}},methods:{resetFilters(){this.selectedFrameworksInt=this.availableFrameworks.filter(e=>!e.disabled),this.selectedCountriesInt=[],this.selectedSectorsInt=[]},closeAllOpenDropDowns(){var e,t,a;(e=this.countryFilter)==null||e.$refs.multiselect.hide(),(t=this.sectorFilter)==null||t.$refs.multiselect.hide(),(a=this.frameworkFilter)==null||a.$refs.multiselect.hide()},async retrieveCountryAndSectorFilterOptions(){const t=await(await new M(x(this.getKeycloakPromise)()).getCompanyDataControllerApi()).getAvailableCompanySearchFilters();this.availableCountries=[...t.data.countryCodes??[]].map(a=>({countryCode:a,displayName:oe(a),disabled:!1})),this.availableSectors=[...t.data.sectors??[]].map(a=>({displayName:a,disabled:!1}))},retrieveAvailableFrameworks(){this.availableFrameworks=C.map(e=>({frameworkDataType:e,displayName:le(e),disabled:!1}))},async retrieveAvailableFilterOptions(){return this.retrieveAvailableFrameworks(),this.retrieveCountryAndSectorFilterOptions()}},mounted(){this.retrieveAvailableFilterOptions()}});const N=e=>(P("data-v-3a507968"),e=e(),T(),e),Ae={class:"flex"},Ve={class:"flex flex-column"},qe={key:0,class:"d-section-heading mb-2"},Ne={class:"flex flex-column ml-3"},Ue={key:0,class:"d-section-heading mb-2"},Oe={class:"flex flex-row align-items-center"},Ee=N(()=>r("div",{class:"d-separator-left"},null,-1)),He=N(()=>r("div",{class:"d-separator-left ml-3"},null,-1));function Le(e,t,a,s,u,y){const i=l("FrameworkDataSearchDropdownFilter");return d(),m("div",Ae,[r("div",Ve,[e.showHeading?(d(),m("span",qe,"Filter by company")):w("",!0),r("div",null,[n(i,{modelValue:e.selectedSectorsInt,"onUpdate:modelValue":t[0]||(t[0]=o=>e.selectedSectorsInt=o),ref:"sectorFilter","available-items":e.availableSectors,"filter-name":"Sector","filter-id":"sector-filter","filter-placeholder":"Search sectors"},null,8,["modelValue","available-items"]),n(i,{modelValue:e.selectedCountriesInt,"onUpdate:modelValue":t[1]||(t[1]=o=>e.selectedCountriesInt=o),ref:"countryFilter","available-items":e.availableCountries,"filter-name":"Country","filter-id":"country-filter","filter-placeholder":"Search countries",class:"ml-3"},null,8,["modelValue","available-items"])])]),r("div",Ne,[e.showHeading?(d(),m("span",Ue,"Filter by data")):w("",!0),r("div",Oe,[Ee,n(i,{modelValue:e.selectedFrameworksInt,"onUpdate:modelValue":t[2]||(t[2]=o=>e.selectedFrameworksInt=o),ref:"frameworkFilter","available-items":e.availableFrameworks,"filter-name":"Framework","filter-id":"framework-filter","filter-placeholder":"Search frameworks",class:"ml-3"},null,8,["modelValue","available-items"]),He,r("span",{class:"ml-3 cursor-pointer text-primary font-semibold d-letters",onClick:t[3]||(t[3]=(...o)=>e.resetFilters&&e.resetFilters(...o))},"RESET")])])])}const Qe=b(Re,[["render",Le],["__scopeId","data-v-3a507968"]]);function $(e){return typeof e=="string"&&e!==""?[e]:Array.isArray(e)?e:[]}function g(e,t){const a=new Set([...e]),s=new Set([...t]);return a.size!==s.size?!1:[...a].every(u=>s.has(u))}const Me=_({setup(){return{searchBarAndFiltersContainer:h(),frameworkDataSearchBar:h(),frameworkDataSearchFilters:h(),searchResults:h(),getKeycloakPromise:V("getKeycloakPromise")}},name:"SearchCompaniesForFrameworkData",components:{NewDatasetButton:ce,RequestDataButton:q,DatasetsTabMenu:de,FrameworkDataSearchFilters:Qe,AuthenticationWrapper:K,TheHeader:W,TheContent:z,FrameworkDataSearchBar:j,PrimeButton:A,FrameworkDataSearchResults:be,TheFooter:ne},created(){window.addEventListener("scroll",this.windowScrollHandler),X(Z,this.getKeycloakPromise).then(e=>{this.hasUserUploaderRights=e}).catch(e=>console.log(e)),this.scanQueryParams(this.route)},data(){return{frameworkFilters:ee(),searchBarToggled:!1,pageScrolled:!1,route:te(),resultsArray:[],latestScrollPosition:0,currentSearchBarInput:"",currentFilteredFrameworks:C,currentFilteredCountryCodes:[],currentFilteredSectors:[],currentCombinedFilter:{companyNameFilter:"",frameworkFilter:[],sectorFilter:[],countryCodeFilter:[]},scrollEmittedByToggleSearchBar:!1,hiddenSearchBarHeight:0,searchBarId:"search_bar_top",indexOfFirstShownRow:0,rowsPerPage:100,waitingForSearchResults:!0,windowScrollHandler:()=>{this.handleScroll()},hasUserUploaderRights:null}},beforeRouteUpdate(e){this.scanQueryParams(e)},watch:{currentFilteredFrameworks:{handler(){this.updateCombinedFilterIfRequired()},deep:!0},currentFilteredCountryCodes:{handler(){this.updateCombinedFilterIfRequired()},deep:!0},currentFilteredSectors:{handler(){this.updateCombinedFilterIfRequired()},deep:!0}},computed:{currentlyVisiblePageText(){const e=this.resultsArray.length;if(this.waitingForSearchResults)return"loading...";if(e===0)return"No results";{const t=this.indexOfFirstShownRow,a=t+(this.rowsPerPage-1)>=e?e-1:t+(this.rowsPerPage-1);return`${t+1}-${a+1} of ${e} results`}}},methods:{setFirstShownRow(e){this.indexOfFirstShownRow=e},handleScroll(){var t,a,s;(t=this.frameworkDataSearchBar)==null||t.$refs.autocomplete.hide();const e=window.scrollY;this.scrollEmittedByToggleSearchBar?this.scrollEmittedByToggleSearchBar=!1:(this.searchBarToggled&&(this.searchBarToggled=!1,this.searchBarId="search_bar_top",window.scrollBy(0,this.hiddenSearchBarHeight)),this.latestScrollPosition>e?(this.latestScrollPosition=e,this.pageScrolled=document.documentElement.scrollTop>=60,(a=this.frameworkDataSearchFilters)==null||a.closeAllOpenDropDowns()):(this.latestScrollPosition=e,this.pageScrolled=document.documentElement.scrollTop>152,(s=this.frameworkDataSearchFilters)==null||s.closeAllOpenDropDowns()))},getQueryFrameworks(e){const t=e.query.framework;if(t!==void 0){const a=C;return $(t).filter(s=>a.includes(s))}else return C},getQueryCountryCodes(e){const t=e.query.countryCode;return t?$(t):[]},getQuerySectors(e){const t=e.query.sector;return t?$(t):[]},getQueryInput(e){const t=e.query.input;return t||""},updateCombinedFilterIfRequired(){this.frameworkFilters.setSelectedFiltersForFrameworks(this.currentFilteredFrameworks),(!g(this.currentFilteredFrameworks,this.currentCombinedFilter.frameworkFilter)||!g(this.currentFilteredSectors,this.currentCombinedFilter.sectorFilter)||!g(this.currentFilteredCountryCodes,this.currentCombinedFilter.countryCodeFilter)||this.currentSearchBarInput!==this.currentCombinedFilter.companyNameFilter)&&(this.waitingForSearchResults=!0,this.currentCombinedFilter={sectorFilter:this.currentFilteredSectors,frameworkFilter:this.currentFilteredFrameworks,companyNameFilter:this.currentSearchBarInput,countryCodeFilter:this.currentFilteredCountryCodes})},scanQueryParams(e){const t=this.getQueryFrameworks(e),a=this.getQueryCountryCodes(e),s=this.getQuerySectors(e),u=this.getQueryInput(e);(!g(this.currentFilteredFrameworks,t)||!g(this.currentFilteredCountryCodes,a)||!g(this.currentFilteredSectors,s)||this.currentSearchBarInput!==u)&&(this.currentFilteredFrameworks=t,this.currentFilteredCountryCodes=a,this.currentFilteredSectors=s,this.currentSearchBarInput=u)},handleCompanyQuery(e){var i;this.resultsArray=e,this.setFirstShownRow(0),(i=this.searchResults)==null||i.resetPagination(),this.waitingForSearchResults=!1,this.searchBarToggled=!1;const t=this.currentSearchBarInput==""?void 0:this.currentSearchBarInput,a=C.every(o=>this.currentFilteredFrameworks.includes(o));let s=this.currentFilteredFrameworks;a&&(s=void 0),this.currentFilteredFrameworks.length==0&&(s=null);const u=this.currentFilteredCountryCodes.length==0?void 0:this.currentFilteredCountryCodes,y=this.currentFilteredSectors.length==0?void 0:this.currentFilteredSectors;return this.$router.push({name:"Search Companies for Framework Data",query:{input:t,framework:s,countryCode:u,sector:y}})},handleSearchConfirmed(e){this.waitingForSearchResults=!0,this.currentSearchBarInput=e},async toggleSearchBar(){this.searchBarToggled=!0,this.scrollEmittedByToggleSearchBar=!0,this.searchBarAndFiltersContainer&&(this.hiddenSearchBarHeight=this.searchBarAndFiltersContainer.clientHeight),window.scrollBy(0,-this.hiddenSearchBarHeight),await this.$nextTick(),this.searchBarId="search_bar_scrolled"}},unmounted(){window.removeEventListener("scroll",this.windowScrollHandler)}});const B=e=>(P("data-v-5ff3292a"),e=e(),T(),e),Ke={class:"flex",id:"searchFiltersContainer"},We=B(()=>r("span",{class:"mr-3 font-semibold"},"Search Data for Companies",-1)),ze=B(()=>r("i",{class:"pi pi-search","aria-hidden":"true",style:{"z-index":"20",color:"#958d7c"}},null,-1)),Ye={key:0,id:"createButtonAndPageTitle",class:"flex align-content-end align-items-center"},je={key:0,class:"d-center-div text-center px-7 py-4"},Ge=B(()=>r("p",{class:"font-medium text-xl"},"Loading...",-1)),Je=B(()=>r("i",{class:"pi pi-spinner pi-spin","aria-hidden":"true",style:{"z-index":"20",color:"#e67f3f"}},null,-1)),xe=[Ge,Je];function Xe(e,t,a,s,u,y){const i=l("TheHeader"),o=l("FrameworkDataSearchBar"),D=l("PrimeButton"),I=l("FrameworkDataSearchFilters"),p=l("RequestDataButton"),U=l("NewDatasetButton"),O=l("FrameworkDataSearchResults"),E=l("TheContent"),H=l("DatasetsTabMenu"),L=l("TheFooter"),Q=l("AuthenticationWrapper");return d(),S(Q,null,{default:c(()=>[n(i),n(H,{"initial-tab-index":0},{default:c(()=>[n(E,{class:"min-h-screen paper-section relative"},{default:c(()=>[r("div",{id:"searchBarAndFiltersContainer",class:v(["w-full bg-white pt-4",[e.pageScrolled&&e.searchBarToggled?["d-search-toggle","fixed"]:""]]),ref:"searchBarAndFiltersContainer"},[n(o,{id:"frameworkDataSearchBar",ref:"frameworkDataSearchBar",class:"pl-4 m-0",modelValue:e.currentSearchBarInput,"onUpdate:modelValue":t[0]||(t[0]=f=>e.currentSearchBarInput=f),filter:e.currentCombinedFilter,searchBarId:e.searchBarId,"emit-search-results-array":!0,onSearchConfirmed:e.handleSearchConfirmed,onCompaniesReceived:e.handleCompanyQuery},null,8,["modelValue","filter","searchBarId","onSearchConfirmed","onCompaniesReceived"]),r("div",{id:"searchFiltersPanel",class:v(["flex justify-content-between align-items-center d-search-filters-panel pl-4 pr-4",[e.pageScrolled&&!e.searchBarToggled?["d-search-toggle","fixed","w-full","bg-white"]:""]])},[r("div",Ke,[r("div",{id:"scrolledSearchToggler",class:v([e.pageScrolled&&!e.searchBarToggled?["flex","align-items-center"]:"hidden"])},[We,n(D,{name:"search_bar_collapse",icon:"pi pi-search",class:"p-button-rounded surface-ground border-none m-2",onClick:e.toggleSearchBar},{default:c(()=>[ze]),_:1},8,["onClick"])],2),n(I,{id:"frameworkDataSearchFilters",class:"ml-3",ref:"frameworkDataSearchFilters","show-heading":!e.pageScrolled||e.searchBarToggled,"selected-country-codes":e.currentFilteredCountryCodes,"onUpdate:selectedCountryCodes":t[1]||(t[1]=f=>e.currentFilteredCountryCodes=f),"selected-frameworks":e.currentFilteredFrameworks,"onUpdate:selectedFrameworks":t[2]||(t[2]=f=>e.currentFilteredFrameworks=f),"selected-sectors":e.currentFilteredSectors,"onUpdate:selectedSectors":t[3]||(t[3]=f=>e.currentFilteredSectors=f)},null,8,["show-heading","selected-country-codes","selected-frameworks","selected-sectors"])]),e.pageScrolled?w("",!0):(d(),m("div",Ye,[n(p),e.hasUserUploaderRights?(d(),S(U,{key:0})):w("",!0),r("span",null,F(e.currentlyVisiblePageText),1)]))],2)],2),e.waitingForSearchResults?(d(),m("div",je,xe)):w("",!0),e.waitingForSearchResults?w("",!0):(d(),S(O,{key:1,ref:"searchResults","rows-per-page":e.rowsPerPage,data:e.resultsArray,"onUpdate:first":e.setFirstShownRow},null,8,["rows-per-page","data","onUpdate:first"]))]),_:1})]),_:1}),n(L)]),_:1})}const kt=b(Me,[["render",Xe],["__scopeId","data-v-5ff3292a"]]);export{kt as default};
//# sourceMappingURL=SearchCompaniesForFrameworkData-f043fb4e.js.map
