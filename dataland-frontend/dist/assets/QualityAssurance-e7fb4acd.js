import{T as F}from"./TheFooter-3b777f63.js";import{T as E,a as M}from"./TheHeader-0690a93c.js";import{M as k,A as l,a as O}from"./ApiClients-c2d52430.js";import{F as N,S as Q,A as $}from"./FailMessage-eccffe20.js";import{d as T,s as q,i as I,e as d,T as x,_ as v,r,o as u,c as D,a as c,v as g,f as s,w as i,n as C,F as K,K as L,H as h,j as B,h as y}from"./index-2a0d7e9b.js";import{A as W}from"./AuthorizationWrapper-126fe2db.js";import{s as j,a as z}from"./column.esm-4af04ca3.js";import{h as V}from"./StringHumanizer-b303955c.js";import{D as H}from"./DatasetsTabMenu-52aae5cd.js";import{c as U}from"./DataFormatUtils-9e016aeb.js";import"./message.esm-a06930d0.js";import"./index.esm-53a24283.js";import"./index.esm-46141996.js";import"./dropdown.esm-db79d236.js";import"./virtualscroller.esm-6815c49e.js";import"./inputtext.esm-51fe2afe.js";import"./index.esm-e4a4c290.js";import"./index.esm-cdf29d06.js";import"./index.esm-64549a61.js";const Y={Pending:"Pending",Accepted:"Accepted",Rejected:"Rejected"},J=T({components:{FailMessage:N,SuccessMessage:Q,MiddleCenterDiv:k,PrimeButton:q},inject:["dialogRef"],name:"QADatasetModal",setup(){return{getKeycloakPromise:I("getKeycloakPromise")}},data(){return{dataSetToReview:null,dataId:"",reviewSubmitted:!1,reviewSuccessful:!1,QaStatus:Y}},mounted(){const t=this.dialogRef.data;this.dataSetToReview=t.dataSetToReview,this.dataId=t.dataId},computed:{datasetAsJson(){return JSON.stringify(this.dataSetToReview,null,2)}},methods:{async setQaStatusTo(a){try{this.reviewSubmitted=!0,await(await new l(d(this.getKeycloakPromise)()).getQaControllerApi()).assignQaStatus(this.dataId,a),this.reviewSuccessful=!0,setTimeout(()=>{this.closeTheDialogAndReloadPage()},x)}catch(t){console.error(t)}},closeTheDialogAndReloadPage(){this.dialogRef.close()}}});const G={id:"dataset-container"},X={key:0},Z={key:1,autofocus:"autofocus"};function aa(a,t,e,p,o,S){const A=r("SuccessMessage"),m=r("FailMessage"),f=r("PrimeButton"),w=r("MiddleCenterDiv");return u(),D(K,null,[c("div",null,[c("pre",G,g(a.datasetAsJson),1)]),s(w,{class:"col-12"},{default:i(()=>[a.reviewSubmitted?(u(),D("div",X,[a.reviewSuccessful?(u(),C(A,{key:0,"success-message":"Review successfully submitted."})):(u(),C(m,{key:1,message:"The resource you tried to access is not available. Please close the data pop-up."}))])):(u(),D("div",Z,[s(f,{onClick:t[0]||(t[0]=_=>a.setQaStatusTo(a.QaStatus.Accepted)),label:"Accept Dataset",id:"accept-button"}),s(f,{onClick:t[1]||(t[1]=_=>a.setQaStatusTo(a.QaStatus.Rejected)),label:"Reject Dataset",id:"reject-button"})]))]),_:1})],64)}const ta=v(J,[["render",aa]]),ea=T({name:"QualityAssurance",components:{DatasetsTabMenu:H,AuthorizationWrapper:W,TheFooter:F,TheContent:E,TheHeader:M,AuthenticationWrapper:O,DataTable:j,Column:z},setup(){return{datasetsPerPage:10,getKeycloakPromise:I("getKeycloakPromise")}},data(){return{dataIdList:[],dataId:"",displayDataOfPage:[],waitingForData:!0,dataSet:null,KEYCLOAK_ROLE_REVIEWER:L,metaInformation:null,companyInformation:null,qaServiceControllerApi:void 0,metaDataInformationControllerApi:void 0,companyDataControllerApi:void 0,currentPage:0}},mounted(){this.getQaDataForCurrentPage().catch(a=>console.log(a))},methods:{convertUnixTimeInMsToDateString:U,humanizeString:V,async getQaDataForCurrentPage(){try{this.waitingForData=!0,this.displayDataOfPage=[];const a=[];await this.gatherControllerApis();const t=await this.qaServiceControllerApi.getUnreviewedDatasetsIds();this.dataIdList=t.data;const e=this.currentPage*this.datasetsPerPage,p=this.dataIdList.slice(e,e+this.datasetsPerPage);for(const o of p)a.push(await this.addDatasetAssociatedInformationToDisplayList(o));this.displayDataOfPage=a,this.waitingForData=!1}catch(a){console.error(a)}},async gatherControllerApis(){this.qaServiceControllerApi=await new l(d(this.getKeycloakPromise)()).getQaControllerApi(),this.metaDataInformationControllerApi=await new l(d(this.getKeycloakPromise)()).getMetaDataControllerApi(),this.companyDataControllerApi=await new l(d(this.getKeycloakPromise)()).getCompanyDataControllerApi()},async addDatasetAssociatedInformationToDisplayList(a){try{const t=await this.metaDataInformationControllerApi.getDataMetaInfo(a);this.metaInformation=t.data;const e=await this.companyDataControllerApi.getCompanyById(this.metaInformation.companyId);return this.companyInformation=e.data.companyInformation,{dataId:a,metaInformation:this.metaInformation,companyInformation:this.companyInformation}}catch(t){if(t instanceof $&&t.response.status!==404)throw t}},async getDataSet(a){try{const t=a.metaInformation.dataType;this.dataId=a.dataId;const e=d(this.getKeycloakPromise)();if(t===h.EutaxonomyNonFinancials){const o=await(await new l(e).getEuTaxonomyDataForNonFinancialsControllerApi()).getCompanyAssociatedEuTaxonomyDataForNonFinancials(this.dataId);this.dataSet=d(o.data.data)}else if(t===h.EutaxonomyFinancials){const o=await(await new l(e).getEuTaxonomyDataForFinancialsControllerApi()).getCompanyAssociatedEuTaxonomyDataForFinancials(this.dataId);this.dataSet=d(o.data.data)}else if(t===h.Lksg){const o=await(await new l(e).getLksgDataControllerApi()).getCompanyAssociatedLksgData(this.dataId);this.dataSet=d(o.data.data)}else if(t===h.Sfdr){const o=await(await new l(e).getSfdrDataControllerApi()).getCompanyAssociatedSfdrData(this.dataId);this.dataSet=d(o.data.data)}else if(t===h.P2p){const o=await(await new l(e).getP2pDataControllerApi()).getCompanyAssociatedP2pData(this.dataId);this.dataSet=d(o.data.data)}else if(t===h.Sme){const o=await(await new l(e).getSmeDataControllerApi()).getCompanyAssociatedSmeData(this.dataId);this.dataSet=d(o.data.data)}else throw new Error("The qaDataObject type of the selected dataset is not supported by the QA frontend.")}catch(t){console.error(t)}},async loadDatasetAndOpenModal(a){const t=a.data;await this.getDataSet(t),this.$dialog.open(ta,{props:{header:"Reviewing "+t.metaInformation.dataType+" data for "+t.companyInformation.companyName+" for the reporting period "+t.metaInformation.reportingPeriod,modal:!0,dismissableMask:!0},data:{dataSetToReview:this.dataSet,dataId:this.dataId},onClose:()=>{this.getQaDataForCurrentPage().catch(e=>console.log(e))}})},async onPage(a){this.currentPage=a.page,await this.getQaDataForCurrentPage()}}});const oa={class:"col-12 text-left p-3"},sa=c("h1",null,"Quality Assurance",-1),na={key:0,class:"d-center-div text-center px-7 py-4"},ia=c("p",{class:"font-medium text-xl"},"Loading data to be reviewed...",-1),ra=c("i",{class:"pi pi-spinner pi-spin","aria-hidden":"true",style:{"z-index":"20",color:"#e67f3f"}},null,-1),da=[ia,ra],la={class:"card"},ca=c("div",{class:"text-right text-primary no-underline font-bold"},[c("span",null,"REVIEW"),c("span",{class:"ml-3"},">")],-1);function pa(a,t,e,p,o,S){const A=r("TheHeader"),m=r("Column"),f=r("DataTable"),w=r("AuthorizationWrapper"),_=r("DatasetsTabMenu"),P=r("TheContent"),R=r("TheFooter"),b=r("AuthenticationWrapper");return u(),C(b,null,{default:i(()=>[s(A),s(P,{class:"paper-section flex"},{default:i(()=>[s(_,{"initial-tab-index":2},{default:i(()=>[s(w,{"required-role":a.KEYCLOAK_ROLE_REVIEWER},{default:i(()=>[c("div",oa,[sa,a.waitingForData?(u(),D("div",na,da)):B("",!0),c("div",la,[s(f,{value:a.displayDataOfPage,class:"table-cursor",id:"qa-data-result",rowHover:!0,"data-test":"qa-review-section",onRowClick:t[0]||(t[0]=n=>a.loadDatasetAndOpenModal(n)),paginator:"","paginator-position":"top",rows:a.datasetsPerPage,lazy:"","total-records":a.dataIdList.length,onPage:t[1]||(t[1]=n=>a.onPage(n))},{default:i(()=>[s(m,{header:"DATA ID",class:"d-bg-white w-2 qa-review-id"},{body:i(n=>[y(g(n.data.dataId),1)]),_:1}),s(m,{header:"COMPANY NAME",class:"d-bg-white w-2 qa-review-company-name"},{body:i(n=>[y(g(n.data.companyInformation.companyName),1)]),_:1}),s(m,{header:"FRAMEWORK",class:"d-bg-white w-2 qa-review-framework"},{body:i(n=>[y(g(a.humanizeString(n.data.metaInformation.dataType)),1)]),_:1}),s(m,{header:"REPORTING PERIOD",class:"d-bg-white w-2 qa-review-reporting-period"},{body:i(n=>[y(g(n.data.metaInformation.reportingPeriod),1)]),_:1}),s(m,{header:"SUBMISSION DATE",class:"d-bg-white w-2 qa-review-submission-date"},{body:i(n=>[y(g(a.convertUnixTimeInMsToDateString(n.data.metaInformation.uploadTime)),1)]),_:1}),s(m,{field:"reviewDataset",header:"",class:"w-2 d-bg-white qa-review-button"},{body:i(()=>[ca]),_:1})]),_:1},8,["value","rows","total-records"])])])]),_:1},8,["required-role"])]),_:1})]),_:1}),s(R)]),_:1})}const Ea=v(ea,[["render",pa]]);export{Ea as default};
//# sourceMappingURL=QualityAssurance-e7fb4acd.js.map
