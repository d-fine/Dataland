import{a as G,M as O,A as b}from"./ApiClients-491035fa.js";import{d as D,_ as w,o as a,c as l,a as o,j as c,F as M,s as k,P as V,r as i,f as s,w as r,h as x,x as C,v as $,Q as I,e as K,p as B,g as S,n as A,J as j,R,U as Z,V as X,W as q,X as J,Y as Q,i as ee,y as te}from"./index-17bd392c.js";import{T as oe,a as se}from"./TheHeader-f0aa2367.js";import{B as ie}from"./BackButton-d912ea90.js";import{c as P,a as E,b as ae}from"./DataFormatUtils-7a776811.js";import{s as ne}from"./dropdown.esm-ee047f36.js";import{s as re}from"./calendar.esm-3b88e815.js";import{M as le}from"./DatalandSettings-e91c35b0.js";import{T as de}from"./TheFooter-46e8b4f5.js";import"./virtualscroller.esm-2abd6d6c.js";import"./index.esm-0d3974a7.js";import"./index.esm-1a2ee9c0.js";const pe=D({name:"UserRolesBadges",props:{userRoles:{type:Array}}}),ce=o("div",{class:"text-left text-xs ml-1 text-600"},"Scope",-1),ue={class:"flex align-items-center justify-content-center"},ye={key:0,"data-test":"userRoleUser",class:"p-badge badge-yellow"},me=o("span",null,"READ",-1),he=[me],fe={key:1,"data-test":"userRoleUploader",class:"p-badge badge-green"},ge=o("span",null,"WRITE",-1),ve=[ge],_e={key:2,"data-test":"userRoleReviewer",class:"p-badge badge-purple"},Ae=o("span",null,"REVIEWER",-1),Ke=[Ae],De={key:3,"data-test":"userRoleAdmin",class:"p-badge badge-blue"},we=o("span",null,"ADMIN",-1),Ce=[we];function $e(e,t,u,n,h,d){return a(),l(M,null,[ce,o("div",ue,[e.userRoles.includes("ROLE_USER")?(a(),l("div",ye,he)):c("",!0),e.userRoles.includes("ROLE_UPLOADER")?(a(),l("div",fe,ve)):c("",!0),e.userRoles.includes("ROLE_REVIEWER")?(a(),l("div",_e,Ke)):c("",!0),e.userRoles.includes("ROLE_ADMIN")?(a(),l("div",De,Ce)):c("",!0)])],64)}const F=w(pe,[["render",$e]]),be=D({name:"ApiKeyCard",components:{PrimeButton:k,PrimeDialog:V,UserRolesBadges:F},emits:["revokeKey"],props:{expiryDateInMilliseconds:{type:Number,default:null},userRoles:{type:Array}},data:()=>({viewDeleteConfirmation:!1}),computed:{keyExpiryInfoText(){return this.expiryDateInMilliseconds&&this.expiryDateInMilliseconds>=Date.now()?`The API Key will expire on ${P(this.expiryDateInMilliseconds)}`:this.expiryDateInMilliseconds&&this.expiryDateInMilliseconds<Date.now()?`The API Key expired on ${P(this.expiryDateInMilliseconds)}`:"The API Key has no defined expiry date"}},methods:{deleteConfirmToggle(){this.viewDeleteConfirmation=!this.viewDeleteConfirmation},isKeyExpired(){return!(this.expiryDateInMilliseconds>=new Date().getTime()||this.expiryDateInMilliseconds==null)}}}),xe=o("h2",{class:"m-0"},"Delete API Key",-1),ke=o("strong",null,"If you confirm, your previous token will be invalidated and your applications will stop working.",-1),Te={id:"existingApiKeyCard",class:"surface-card shadow-1 p-3 border-round-sm border-round"},Ie={class:"flex justify-content-between mb-3"},Re=o("div",{class:"text-900 font-medium text-xl text-left"},"API Key info",-1),Pe={"data-test":"userRoles",class:"pr-1"},Ee={class:"col-12 text-right"};function Me(e,t,u,n,h,d){const f=i("PrimeButton"),p=i("PrimeDialog"),_=i("UserRolesBadges");return a(),l(M,null,[s(p,{id:"revokeModal",dismissableMask:!0,modal:!0,header:"Header",footer:"Footer",visible:e.viewDeleteConfirmation,"onUpdate:visible":t[1]||(t[1]=y=>e.viewDeleteConfirmation=y)},{header:r(()=>[xe]),footer:r(()=>[s(f,{label:"CANCEL",onClick:e.deleteConfirmToggle,class:"p-button-outlined"},null,8,["onClick"]),s(f,{id:"confirmRevokeButton",label:"CONFIRM",onClick:t[0]||(t[0]=y=>e.$emit("revokeKey"))})]),default:r(()=>[x(" Are you sure you want to delete this API key? "),ke]),_:1},8,["visible"]),o("div",null,[o("div",Te,[o("div",Ie,[o("div",null,[Re,o("span",{class:C([{"text-red-700":e.isKeyExpired()},"block text-600 mb-3 mt-6"])},$(e.keyExpiryInfoText),3)]),o("div",Pe,[s(_,{userRoles:e.userRoles},null,8,["userRoles"])])]),o("div",Ee,[s(f,{label:"DELETE",icon:"pi pi-trash",class:"p-button-outlined ml-3 px-4 border-2 p-button-danger",onClick:e.deleteConfirmToggle},null,8,["onClick"])])])])],64)}const Ve=w(be,[["render",Me]]),Be=D({name:"CreateApiKeyCard",components:{PrimeButton:k,Dropdown:ne,Calendar:re,UserRolesBadges:F},props:{userRoles:{type:Array}},data:()=>({expiryTimeDays:null,expiryTimeDropdown:"",isExpiryDateValid:!0,minDate:new Date(new Date().getTime()+I),maxDate:new Date(new Date().getTime()+le*I),customDateInMilliseconds:null,days:[{label:"7 days",value:7},{label:"30 days",value:30},{label:"60 days",value:60},{label:"90 days",value:90},{label:"Custom...",value:"custom"},{label:"No expiry",value:"noExpiry"}]}),methods:{setExpiryTimeDays(e){e.value==="noExpiry"?this.expiryTimeDays=null:e.value==="custom"?this.expiryTimeDays=this.customDateInMilliseconds?E(this.customDateInMilliseconds):null:this.expiryTimeDays=parseInt(e.value),this.isExpiryDateValid=!0},checkDateAndEmitGenerateApiKey(){this.expiryTimeDays?this.$emit("generateApiKey",this.expiryTimeDays):this.expiryTimeDropdown==="noExpiry"?this.$emit("generateApiKey"):this.isExpiryDateValid=!1}},computed:{expiryDateFormated(){return ae(K(this.expiryTimeDays))}},watch:{customDateInMilliseconds:function(e){this.expiryTimeDays=E(e),this.isExpiryDateValid=!0}}});const Se=e=>(B("data-v-6ae586c1"),e=e(),S(),e),Fe={class:"surface-card shadow-1 p-3 border-round-sm border-round"},He={class:"flex justify-content-between mb-3"},Ue=Se(()=>o("div",null,[o("div",{class:"text-900 font-medium text-xl text-left pl-1"},"API Key info")],-1)),ze={"data-test":"userRoles",class:"pr-1"},Ne={class:"text-left col-5"},Le={key:0,class:"col-7 text-right"},We={key:1,id:"expiryTimeWrapper",class:"block text-600 col-7"},Ye={class:"mt-3 text-right"};function Ge(e,t,u,n,h,d){const f=i("UserRolesBadges"),p=i("Dropdown"),_=i("Calendar"),y=i("PrimeButton");return a(),l("div",null,[o("div",Fe,[o("div",He,[Ue,o("div",ze,[s(f,{userRoles:e.userRoles},null,8,["userRoles"])])]),o("div",{class:C([{invalidExpiryTime:!e.isExpiryDateValid},"col-12 flex justify-content-between align-items-end"])},[o("div",Ne,[o("label",{for:"expiryTime",class:C([{invalidExpiryTimeText:!e.isExpiryDateValid,"text-900":e.isExpiryDateValid},"block font-medium mb-2"])},$(e.isExpiryDateValid?"Expiration":"Please select expiration date"),3),s(p,{id:"expiryTime",modelValue:e.expiryTimeDropdown,"onUpdate:modelValue":t[0]||(t[0]=g=>e.expiryTimeDropdown=g),options:e.days,optionLabel:"label",optionValue:"value",placeholder:"Select expiry",class:"w-full custom-dropdown",onChange:t[1]||(t[1]=g=>e.setExpiryTimeDays(g))},null,8,["modelValue","options"])]),e.expiryTimeDropdown==="custom"?(a(),l("div",Le,[s(_,{"data-test":"expiryDatePicker",inputId:"icon",modelValue:e.customDateInMilliseconds,"onUpdate:modelValue":t[2]||(t[2]=g=>e.customDateInMilliseconds=g),showIcon:!0,dateFormat:"D, M dd, yy",minDate:e.minDate,maxDate:e.maxDate},null,8,["modelValue","minDate","maxDate"])])):c("",!0),e.expiryTimeDropdown&&e.expiryTimeDropdown!=="custom"?(a(),l("span",We,$(e.expiryTimeDropdown==="noExpiry"?"The API Key has no defined expiry date":`The API Key will expire on ${e.expiryDateFormated}`),1)):c("",!0)],2)]),o("div",Ye,[s(y,{"data-test":"cancelGenerateApiKey",label:"CANCEL",onClick:t[3]||(t[3]=g=>e.$emit("cancelCreate")),class:"p-button-outlined ml-3"}),s(y,{id:"generateApiKey",onClick:e.checkDateAndEmitGenerateApiKey,label:"GENERATE API KEY",class:"ml-3"},null,8,["onClick"])])])}const Oe=w(Be,[["render",Ge],["__scopeId","data-v-6ae586c1"]]),je=D({name:"MessageComponent",props:{severity:{type:String,default:null}},data(){return{visible:!0}},computed:{containerClass(){return" p-message-"+this.severity}}});const Ze={class:"p-message-wrapper"},Xe={"data-test":"text-info",class:"text-left"},qe={"data-test":"action-button",class:"text-right action-button ml-auto"};function Je(e,t,u,n,h,d){return a(),A(X,{name:"p-message",appear:""},{default:r(()=>[j(o("div",{class:C([e.containerClass,"p-message p-component border-round-sm"])},[o("div",Ze,[o("div",Xe,[R(e.$slots,"text-info")]),o("div",qe,[R(e.$slots,"action-button")])])],2),[[Z,e.visible]])]),_:3})}const Qe=w(je,[["render",Je]]);var et=`
.p-inputtextarea-resizable {
    overflow: hidden;
    resize: none;
}

.p-fluid .p-inputtextarea {
    width: 100%;
}
`,tt={root:function(t){var u=t.instance,n=t.props;return["p-inputtextarea p-inputtext p-component",{"p-filled":u.filled,"p-inputtextarea-resizable ":n.autoResize}]}},ot=q(et,{name:"textarea",manual:!0}),st=ot.load,it={name:"BaseTextarea",extends:Q,props:{modelValue:null,autoResize:Boolean},css:{classes:tt,loadStyle:st},provide:function(){return{$parentInstance:this}}},H={name:"Textarea",extends:it,emits:["update:modelValue"],mounted:function(){this.$el.offsetParent&&this.autoResize&&this.resize()},updated:function(){this.$el.offsetParent&&this.autoResize&&this.resize()},methods:{resize:function(){var t=window.getComputedStyle(this.$el);this.$el.style.height="auto",this.$el.style.height="calc(".concat(t.borderTopWidth," + ").concat(t.borderBottomWidth," + ").concat(this.$el.scrollHeight,"px)"),parseFloat(this.$el.style.height)>=parseFloat(this.$el.style.maxHeight)?(this.$el.style.overflowY="scroll",this.$el.style.height=this.$el.style.maxHeight):this.$el.style.overflow="hidden"},onInput:function(t){this.autoResize&&this.resize(),this.$emit("update:modelValue",t.target.value)}},computed:{filled:function(){return this.modelValue!=null&&this.modelValue.toString().length>0},ptmParams:function(){return{context:{disabled:this.$attrs.disabled||this.$attrs.disabled===""}}}}},at=["value"];function nt(e,t,u,n,h,d){return a(),l("textarea",J({class:e.cx("root"),value:e.modelValue,onInput:t[0]||(t[0]=function(){return d.onInput&&d.onInput.apply(d,arguments)})},e.ptm("root",d.ptmParams),{"data-pc-name":"textarea"}),null,16,at)}H.render=nt;const rt=D({name:"ApiKeysPage",components:{AuthenticationWrapper:G,TheContent:oe,TheHeader:se,MiddleCenterDiv:O,BackButton:ie,PrimeButton:k,PrimeDialog:V,ApiKeyCard:Ve,CreateApiKeyCard:Oe,MessageComponent:Qe,PrimeTextarea:H,TheFooter:de},setup(){return{getKeycloakPromise:ee("getKeycloakPromise"),newKeyHolderRef:te(null)}},data(){return{pageState:"view",userAlreadyHasApiKey:!1,waitingForData:!0,regenerateConfirmationVisible:!1,newKey:"",expiryDate:void 0,userRolesAccordingToApiKey:[],userRolesAccordingToKeycloak:[]}},computed:{pageTitle(){return this.pageState==="view"?"API Key":this.pageState==="create"?"Create new API Key":"API"}},props:{},mounted(){this.getApiKeyMetaInfoForUser()},methods:{setActivePageState(e){this.pageState=e},async getApiKeyMetaInfoForUser(){var e,t,u,n;try{const d=await K(this.getKeycloakPromise)(),p=await(await new b(K(this.getKeycloakPromise)()).getApiKeyManagerController()).getApiKeyMetaInfoForUser();this.waitingForData=!1,this.userRolesAccordingToApiKey=p.data.keycloakRoles?p.data.keycloakRoles:[],this.userRolesAccordingToKeycloak=(t=(e=d.tokenParsed)==null?void 0:e.realm_access)!=null&&t.roles?(n=(u=d.tokenParsed)==null?void 0:u.realm_access)==null?void 0:n.roles:[],this.userAlreadyHasApiKey=p.data.active?p.data.active:!1,this.expiryDate=p.data.expiryDate?p.data.expiryDate:void 0}catch(h){console.error(h)}},async revokeApiKey(){try{const e=K(this.getKeycloakPromise);await(await new b(e()).getApiKeyManagerController()).revokeApiKey(),this.userAlreadyHasApiKey=!1}catch(e){console.error(e)}},async generateApiKey(e){try{this.waitingForData=!0;const t=K(this.getKeycloakPromise),n=await(await new b(t()).getApiKeyManagerController()).generateApiKey(e);this.waitingForData=!1,this.userAlreadyHasApiKey=!0,this.expiryDate=n.data.apiKeyMetaInfo.expiryDate?n.data.apiKeyMetaInfo.expiryDate:void 0,this.newKey=n.data.apiKey,this.userRolesAccordingToApiKey=n.data.apiKeyMetaInfo.keycloakRoles?n.data.apiKeyMetaInfo.keycloakRoles:[],this.setActivePageState("view")}catch(t){console.error(t),this.userAlreadyHasApiKey=!1}},regenerateConfirmToggle(){this.regenerateConfirmationVisible=!this.regenerateConfirmationVisible},copyToClipboard(){this.newKeyHolderRef&&this.newKeyHolderRef.$el.focus(),navigator.clipboard.writeText(this.newKey)}}}),lt={xmlns:"http://www.w3.org/2000/svg",height:"200",viewBox:"0 0 353 494"},dt=o("path",{fill:"#e0dfde",d:"M110 358v-21c-.02-11.94-2.41-8.93-17-17.6-12.76-7.59-24.62-16.78-34.99-27.4-20.94-21.45-35.07-48.89-41.66-78-1.41-6.23-3.27-16.75-3.35-23-.18-15.55-.62-29.64 2.45-45C25.72 94.64 59.17 51.21 107 29.31 170.13.4 248.42 15 295.91 66c13.79 14.8 24.61 32.25 32.09 51 5.63 14.12 10.98 34.81 11 50v22c-.05 31.76-16.49 68.7-36.26 93-11.72 14.41-24.99 25.77-40.74 35.58-3.81 2.37-17.34 8.86-18.98 11.63-1.22 2.08-1.02 5.41-1.02 7.79v21H110Zm111-35v-10c.07-10.1 2.1-7.8 16-14.75 12.75-6.38 26-15.06 35.99-25.25 19.64-20.04 38.97-61.6 39.01-90v-10c-.02-13.13-4.76-29.8-9.6-42-15.87-39.99-38.34-63.02-78.4-79-10.86-4.33-29.43-9.86-41-10h-12c-30.01.05-72.47 20.6-92.96 42-19.08 19.92-38 61.09-38.04 89v12c.1 7.87 2.69 18.36 4.86 26 6.77 23.89 21.31 51.34 40.14 67.71 8.99 7.82 21.29 15.27 32 20.53 3.52 1.73 14.27 5.5 15.98 8.15 1.58 2.46 1.02 12.27 1.02 15.61h87Zm-111 44h132v34H110v-34Zm0 43h132v35h-22l-.51 22.96c-.64 2.03-1.84 3.63-3.68 4.73-2.57 1.53-5.92 1.3-8.81 1.31h-62c-9.74-.02-12.93-1.68-13-12v-17h-22v-35Zm581-49"},null,-1),pt=[dt];function ct(e,t){return a(),l("svg",lt,pt)}const ut={render:ct};const v=e=>(B("data-v-6c6d2f37"),e=e(),S(),e),yt={class:"col-12 text-left pb-0"},mt=v(()=>o("div",{class:"col-6 md:col-8 lg:col-12"},[o("p",{class:"font-medium text-xl"},"Loading Api Key information..."),o("i",{class:"pi pi-spinner pi-spin","aria-hidden":"true",style:{"z-index":"20",color:"#e67f3f"}})],-1)),ht=v(()=>o("img",{alt:"light bulb",src:ut},null,-1)),ft=v(()=>o("p",{class:"font-medium text-xl text-color-third"},"You have no API Key!",-1)),gt={key:2,"data-test":"CreateApiKeyCard",class:"col-12 md:col-8 lg:col-6"},vt={key:3,"data-test":"apiKeyInfo",class:"apiKeyInfo"},_t={class:"col-12 md:col-8 lg:col-6"},At=v(()=>o("div",{class:"col-12"},"Make sure to copy your API Key now. You will not be able to access it again.",-1)),Kt={class:"my-2"},Dt={class:"p-input-icon-right border-round-sm paper-section pl-1 col-10 fs-lg"},wt=v(()=>o("div",{id:"apiKeyUsageInfoMessage",class:"surface-card shadow-1 p-3 border-round-sm border-round mt-3"},[o("div",null,[o("div",{class:"text-900 font-medium text-xl text-left"},"API Key usage info"),o("div",{class:"block text-600 mb-2 mt-4 text-left"},' You can use the API-Keys as bearer-tokens by including them in the authorization header of any requests you make to Dataland (i.e., "Authorization: Bearer <API Key>"). ')])],-1)),Ct=v(()=>o("h2",{class:"m-0"},"Regenerate API Key",-1)),$t=v(()=>o("strong",null,"If you confirm, your previous token will be invalidated and your applications will stop working.",-1));function bt(e,t,u,n,h,d){const f=i("TheHeader"),p=i("BackButton"),_=i("MiddleCenterDiv"),y=i("PrimeButton"),g=i("CreateApiKeyCard"),U=i("PrimeTextarea"),T=i("MessageComponent"),z=i("ApiKeyCard"),N=i("TheContent"),L=i("PrimeDialog"),W=i("TheFooter"),Y=i("AuthenticationWrapper");return a(),A(Y,null,{default:r(()=>[s(f),s(N,{class:"paper-section flex"},{default:r(()=>[o("div",yt,[s(p),o("h1",null,$(e.pageTitle),1)]),e.waitingForData?(a(),A(_,{key:0,class:"col-12"},{default:r(()=>[mt]),_:1})):c("",!0),!e.userAlreadyHasApiKey&&!e.waitingForData&&this.pageState!=="create"?(a(),A(_,{key:1,"data-test":"noApiKeyWelcomeComponent",class:"col-12"},{default:r(()=>[o("div",null,[ht,ft,s(y,{onClick:t[0]||(t[0]=m=>e.setActivePageState("create")),label:"CREATE NEW API KEY",icon:"pi pi-plus"})])]),_:1})):c("",!0),this.pageState==="create"&&!e.waitingForData?(a(),l("div",gt,[s(g,{userRoles:e.userRolesAccordingToKeycloak,onCancelCreate:t[1]||(t[1]=m=>e.setActivePageState("view")),onGenerateApiKey:e.generateApiKey},null,8,["userRoles","onGenerateApiKey"])])):c("",!0),e.userAlreadyHasApiKey&&!e.waitingForData&&e.pageState==="view"?(a(),l("div",vt,[o("div",_t,[e.newKey.length?(a(),A(T,{key:0,"data-test":"newKeyHolder",severity:"success",closable:!1,class:"border-2"},{"text-info":r(()=>[At,o("div",Kt,[o("div",Dt,[s(U,{ref:"newKeyHolderRef",onFocus:t[2]||(t[2]=m=>m.target.select()),autoResize:!0,cols:"5",modelValue:e.newKey,"onUpdate:modelValue":t[3]||(t[3]=m=>e.newKey=m),id:"newKeyHolder",readonly:"",placeholder:"Key goes here",class:"p-inputText p-component col-10"},null,8,["modelValue"]),o("em",{onClick:t[4]||(t[4]=(...m)=>e.copyToClipboard&&e.copyToClipboard(...m)),class:"pi pi-clone form-inputs-bg primary-color copy-button fs-lg"})])])]),_:1})):c("",!0),e.newKey?c("",!0):(a(),A(T,{key:1,"data-test":"regenerateApiKeyMessage",severity:"block",class:"border-2"},{"text-info":r(()=>[x(" If you don't have access to your API Key you can generate a new one. ")]),"action-button":r(()=>[s(y,{onClick:e.regenerateConfirmToggle,label:"REGENERATE API KEY"},null,8,["onClick"])]),_:1})),s(z,{userRoles:e.userRolesAccordingToApiKey,expiryDateInMilliseconds:e.expiryDate,onRevokeKey:e.revokeApiKey},null,8,["userRoles","expiryDateInMilliseconds","onRevokeKey"]),wt])])):c("",!0)]),_:1}),s(L,{id:"regenerateApiKeyModal",dismissableMask:!0,modal:!0,header:"Header",footer:"Footer",visible:e.regenerateConfirmationVisible,"onUpdate:visible":t[6]||(t[6]=m=>e.regenerateConfirmationVisible=m)},{header:r(()=>[Ct]),footer:r(()=>[s(y,{"data-test":"regenerateApiKeyCancelButton",label:"CANCEL",onClick:e.regenerateConfirmToggle,class:"p-button-outlined"},null,8,["onClick"]),s(y,{"data-test":"regenerateApiKeyConfirmButton",label:"CONFIRM",onClick:t[5]||(t[5]=()=>{e.setActivePageState("create"),e.regenerateConfirmToggle()})})]),default:r(()=>[x(" Are you sure you want to Regenerate your API Key? "),$t]),_:1},8,["visible"]),s(W)]),_:1})}const Ht=w(rt,[["render",bt],["__scopeId","data-v-6c6d2f37"]]);export{Ht as default};
//# sourceMappingURL=ApiKeysPage-677c37d2.js.map
