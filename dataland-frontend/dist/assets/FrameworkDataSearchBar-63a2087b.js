import{I as w,s as F,S as C}from"./SearchResultHighlighter-19e23baa.js";import{A}from"./ApiClients-630cb537.js";import{Q as O}from"./qa-status-272129d3.js";import{L as u,O as B,d as k,i as D,y as N,u as R,e as d,_,r as m,o as h,c as f,a as s,f as y,w as I,j as P,aj as p}from"./index-fc17b7c3.js";function v(e){const t=e.companyInformation.identifiers[w.PermId];return t.length==1?t[0]:t.length==0?"":(console.error("More than one PermId found for a specific company"),t[0])}function K(e){return e.map(t=>({companyName:t.companyInformation.companyName,companyInformation:t.companyInformation,companyId:t.companyId,permId:v(t),dataRegisteredByDataland:t.dataRegisteredByDataland}))}async function g(e,t,a,r,i,c){let o=[];try{const l=await new A(c).getCompanyDataControllerApi();a.size===0&&(a=new Set(u));const S=(await l.getCompanies(e,a,r,i,t)).data;o=K(V(S))}catch(l){console.error(l)}return o}function V(e){return e.filter(t=>t.dataRegisteredByDataland.some(a=>a.qaStatus==O.Accepted))}function b(e,t=B().selectedFiltersForFrameworks){var c;const a=e.dataRegisteredByDataland.filter(o=>o.currentlyActive),r=t.length==0?u:t,i=(c=a.find(o=>r.includes(o.dataType)))==null?void 0:c.dataType;if(i)return`/companies/${e.companyId}/frameworks/${i}`;throw new Error("No data meta info for the frameworks set in the filters could be found in the data of the server response.")}const T=k({setup(){return{getKeycloakPromise:D("getKeycloakPromise"),autocomplete:N()}},name:"FrameworkDataSearchBar",components:{AutoComplete:F,SearchResultHighlighter:C},emits:["companies-received","search-confirmed"],props:{companyIdIfOnViewPage:{type:String},searchBarId:{type:String,default:"framework_data_search_bar_standard"},filter:{type:Object,default(){return{companyNameFilter:"",frameworkFilter:u,sectorFilter:[],countryCodeFilter:[]}}},maxNumOfDisplayedAutocompleteEntries:{type:Number,default:3},emitSearchResultsArray:{type:Boolean,default:!1}},mounted(){var e;this.searchBarInput=((e=this.filter)==null?void 0:e.companyNameFilter)??"",this.queryCompany(),this.route.query.input||this.focusOnSearchBar()},watch:{searchBarId(){this.focusOnSearchBar()},searchBarInput(e){this.saveCurrentSearchStringIfValid(e)},filter:{handler(){var e;this.searchBarInput=((e=this.filter)==null?void 0:e.companyNameFilter)??"",this.queryCompany()},deep:!0}},data:function(){return{wereKeysPressed:!1,currentFocusedOptionIndex:-1,searchBarInput:"",latestValidSearchString:"",autocompleteArray:[],autocompleteArrayDisplayed:[],route:R()}},methods:{noteThatAKeyWasPressed(){this.wereKeysPressed=!0},saveCurrentSearchStringIfValid(e){e&&typeof e=="string"&&(this.latestValidSearchString=e)},getCurrentFocusedOptionIndex(){this.currentFocusedOptionIndex=this.autocomplete.focusedOptionIndex},setCurrentFocusedOptionIndexToDefault(){this.currentFocusedOptionIndex=-1},focusOnSearchBar(){var a;((a=this.autocomplete)==null?void 0:a.$refs).focusInput.focus()},handleItemSelect(e){this.companyIdIfOnViewPage!=e.value.companyId?this.$router.push(b(e.value)):this.searchBarInput=e.value.companyName},executeSearchIfNoItemFocused(){this.currentFocusedOptionIndex===-1&&this.wereKeysPressed&&(this.autocomplete.hide(),this.autocomplete.$refs.focusInput.blur(),this.$emit("search-confirmed",this.searchBarInput),this.queryCompany())},async queryCompany(){var e,t,a;if(this.emitSearchResultsArray){const r=await g(this.searchBarInput,!1,new Set((e=this.filter)==null?void 0:e.frameworkFilter),new Set((t=this.filter)==null?void 0:t.countryCodeFilter),new Set((a=this.filter)==null?void 0:a.sectorFilter),d(this.getKeycloakPromise)());this.$emit("companies-received",r)}},async searchCompanyName(e){var t,a,r;this.autocompleteArray=await g(e.query,!0,new Set((t=this.filter)==null?void 0:t.frameworkFilter),new Set((a=this.filter)==null?void 0:a.countryCodeFilter),new Set((r=this.filter)==null?void 0:r.sectorFilter),d(this.getKeycloakPromise)()),this.autocompleteArrayDisplayed=this.autocompleteArray.slice(0,this.maxNumOfDisplayedAutocompleteEntries)}}}),$={class:"grid"},x={class:"col-8 text-left"},E={class:"p-fluid"},q={class:"p-input-icon-left p-input-icon-right"},j=s("i",{class:"pi pi-search d-framework-searchbar-input-icon","aria-hidden":"true",style:{"z-index":"20",color:"#958d7c"}},null,-1),W=s("i",{class:"pi pi-search pl-3 pr-3","aria-hidden":"true"},null,-1),H={key:0,class:"p-autocomplete-items pt-0"},z=s("span",{class:"text-primary font-medium underline pl-3"}," View all results ",-1),L=[z];function M(e,t,a,r,i,c){const o=m("SearchResultHighlighter"),l=m("AutoComplete");return h(),f("div",$,[s("div",x,[s("span",E,[s("span",q,[j,y(l,{inputId:e.searchBarId,ref:"autocomplete",modelValue:e.searchBarInput,"onUpdate:modelValue":t[1]||(t[1]=n=>e.searchBarInput=n),suggestions:e.autocompleteArrayDisplayed,optionLabel:"companyName",autoOptionFocus:!1,placeholder:"Search company by name or PermID",inputClass:"h-3rem d-framework-searchbar-input",panelClass:"d-framework-searchbar-panel",style:{"z-index":"10"},onComplete:e.searchCompanyName,onKeydown:[e.noteThatAKeyWasPressed,p(e.getCurrentFocusedOptionIndex,["down"]),p(e.getCurrentFocusedOptionIndex,["up"])],onItemSelect:e.handleItemSelect,onKeyup:p(e.executeSearchIfNoItemFocused,["enter"]),onFocus:e.setCurrentFocusedOptionIndexToDefault},{option:I(n=>[W,y(o,{text:n.option.companyName,searchString:e.latestValidSearchString},null,8,["text","searchString"])]),footer:I(()=>[e.autocompleteArray&&e.autocompleteArray.length>=e.maxNumOfDisplayedAutocompleteEntries?(h(),f("ul",H,[s("li",{class:"p-autocomplete-item",onClick:t[0]||(t[0]=(...n)=>e.executeSearchIfNoItemFocused&&e.executeSearchIfNoItemFocused(...n))},L)])):P("",!0)]),_:1},8,["inputId","modelValue","suggestions","onComplete","onKeydown","onItemSelect","onKeyup","onFocus"])])])])])}const J=_(T,[["render",M]]);export{J as F,b as g};
//# sourceMappingURL=FrameworkDataSearchBar-63a2087b.js.map
