package org.dataland.Dataland_E2ETestApp.tests

import io.restassured.module.kotlin.extensions.Extract
import io.restassured.module.kotlin.extensions.Then
import io.restassured.module.kotlin.extensions.When
import org.dataland.Dataland_E2ETestApp.clients.backend.apis.HealthControllerApi
import org.junit.jupiter.api.Assertions
import org.junit.jupiter.api.Test
import org.openapitools.client.apis.DataControllerApi


class HealthControlllerTest {

    //The following test currently fails (02.16.2022, 9:04 Berlin Time), probably because the endpoint returns a JSON with content "UP" instead of plain/text as originally expected.

    @Test
    fun `test if endpoint responds "healthy"`() {
        val responseMessage =
        When {
            get("http://backend:8080/actuator/health")
        } Then {
            statusCode(200)
        } Extract {
            response().body.asString()
        }
        Assertions.assertEquals("UP", responseMessage)
    }

    // Do the same test by using the HealthControllerAPI generated by openAPI:
/*
    @Test
    fun testGetHealthWithClientCode() {
        // Before:
        val healthControllerApi = HealthControllerApi(basePath = "http://localhost:8080")
        val responseMessage = healthControllerApi.getHealth()
        // print(responseMessage)
        // Test:
        // Assertions.assertEquals("Healthy", responseMessage)
    }
*/
}
